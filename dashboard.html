<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Painel de Controle - AgendAI</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet" />
  <script src="https://unpkg.com/feather-icons"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      font-family: 'Poppins', sans-serif;
      background-color: #f1f5f9;
    }
    ::-webkit-scrollbar {
      width: 8px;
    }
    ::-webkit-scrollbar-track {
      background: #f1f5f9;
    }
    ::-webkit-scrollbar-thumb {
      background: #94a3b8;
      border-radius: 10px;
    }
    .spinner,
    .spinner-large {
      border-radius: 50%;
      animation: spin 1s ease-in-out infinite;
    }
    .spinner {
      border: 2px solid rgba(255, 255, 255, 0.3);
      border-top-color: #fff;
      width: 16px;
      height: 16px;
    }
    .spinner-large {
      border: 4px solid rgba(100, 116, 139, 0.2);
      border-top-color: #4f46e5;
      width: 50px;
      height: 50px;
    }
    @keyframes spin {
      to {
        transform: rotate(360deg);
      }
    }
    .toggle-checkbox:checked + .toggle-label {
      background-color: #4f46e5;
    }
    .calendar-grid {
      display: grid;
      grid-template-columns: 50px repeat(7, 1fr);
      position: relative;
    }
    .day-column {
      position: relative;
    }
    .time-slot {
      height: 60px;
    }
    .input-style {
      margin-top: 0.25rem;
      display: block;
      width: 100%;
      padding: 0.5rem;
      border: 1px solid #cbd5e1;
      border-radius: 0.375rem;
    }
    .time-slot-btn:disabled {
      background-color: #f1f5f9;
      color: #94a3b8;
      cursor: not-allowed;
      border-color: #e2e8f0;
    }
    .time-slot-btn.selected {
      background-color: #4f46e5;
      color: white;
    }
  </style>
</head>
<body class="bg-slate-100">
  <!-- ... TODO O CONTEÚDO IGUAL AO QUE VOCÊ ME ENVIOU ... -->

  <!-- AQUI FICA O SCRIPT QUE FOI ATUALIZADO COM A NOVA LÓGICA -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-app.js";
    import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-auth.js";
    import { getFirestore, doc, getDoc, setDoc, onSnapshot, query, collection, addDoc, getDocs, Timestamp, orderBy, where } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyAkIUtakV64F2SYjvJylTGlw8-vTfXc3Fk",
      authDomain: "agendabarber-3fe30.firebaseapp.com",
      projectId: "agendabarber-3fe30",
      storageBucket: "agendabarber-3fe30.appspot.com",
      messagingSenderId: "1098037500040",
      appId: "1:1098037500040:web:62c82a203a3276ffaa273d"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    // ... resto do código igual ...

    // Função modificada para popular horários de agendamento dinâmicos
    function generateTimeOptions(startTime, endTime) {
      const start = new Date(`1970-01-01T${startTime}`);
      const end = new Date(`1970-01-01T${endTime}`);
      const times = [];
      while (start < end) {
        times.push(start.toTimeString().slice(0, 5));
        start.setMinutes(start.getMinutes() + 30);
      }
      return times;
    }

    async function loadAvailableHours(userId, selectedDate) {
      const weekday = ['dom', 'seg', 'ter', 'qua', 'qui', 'sex', 'sab'][new Date(selectedDate).getDay()];
      const ref = doc(db, 'users', userId, 'settings', 'workingHours');
      const docSnap = await getDoc(ref);
      if (!docSnap.exists()) return [];
      const config = docSnap.data();
      const dia = config[weekday];
      if (!dia?.isOpen) return [];
      return generateTimeOptions(dia.start, dia.end);
    }

    // Uso dessa função na interface de criação de agendamento
    // Exemplo:
    // const availableTimes = await loadAvailableHours(userId, dataSelecionada);
    // popular o <select> de horários com esses times

  </script>
</body>
</html>
